"use strict";(self.webpackChunkinterzone=self.webpackChunkinterzone||[]).push([[12679,93431],{93431:(e,t,i)=>{function a(e){let t=["".concat(e.domain," wants you to sign in with your ").concat("Ethereum"," account:"),e.address].join("\n");t=[t,e.statement].join("\n\n"),e.statement&&(t+="\n");const i=[];if(e.uri){const t="URI: ".concat(e.uri);i.push(t)}const a="Version: ".concat(e.version);if(i.push(a),e.chain_id){const t="Chain ID: ".concat(e.chain_id)||0;i.push(t)}const n="Nonce: ".concat(e.nonce);i.push(n);const o="Issued At: ".concat(e.issued_at);i.push(o);const s="Expiration Time: ".concat(e.expiration_time);if(i.push(s),e.invalid_before){const t="Not Before: ".concat(e.invalid_before);i.push(t)}e.resources&&i.push(["Resources:",...e.resources.map((e=>"- ".concat(e)))].join("\n"));return[t,i.join("\n")].join("\n")}async function n(e){const{payload:t,account:i}=e;return{signature:await i.signMessage({message:a(t)}),payload:t}}i.r(t),i.d(t,{signLoginPayload:()=>n})},86085:(e,t,i)=>{i.d(t,{K:()=>r,f:()=>s});var a=i(18342),n=i(87029);const o=e=>{if(!n.N.includes(e)&&"wallet"!==e)throw new Error("Unknown auth option ".concat(e));return"wallet"===e?"siwe":e},s=e=>{let{authOption:t,client:i,ecosystem:n,mode:s="popup",redirectUrl:r}=e;const c=o(t);let l="".concat((0,a.Wg)("inAppWallet"),"/api/2024-05-05/login/").concat(c,"?clientId=").concat(i.clientId);if(null!==n&&void 0!==n&&n.partnerId?l="".concat(l,"&ecosystemId=").concat(n.id,"&ecosystemPartnerId=").concat(n.partnerId):n&&(l="".concat(l,"&ecosystemId=").concat(n.id)),"redirect"===s){const e=new URL(r||window.location.href);e.searchParams.set("walletId",(null===n||void 0===n?void 0:n.id)||"inApp"),e.searchParams.set("authProvider",t),l="".concat(l,"&redirectUrl=").concat(encodeURIComponent(e.toString()))}if("mobile"===s){if(!r)throw new Error("Redirect URL is required for mobile authentication");l="".concat(l,"&redirectUrl=").concat(encodeURIComponent(r))}return l},r=e=>{let{authOption:t,client:i,ecosystem:n}=e;const s=o(t);let r="".concat((0,a.Wg)("inAppWallet"),"/api/2024-05-05/login/").concat(s,"/callback?clientId=").concat(i.clientId);return null!==n&&void 0!==n&&n.partnerId?r="".concat(r,"&ecosystemId=").concat(n.id,"&ecosystemPartnerId=").concat(n.partnerId):n&&(r="".concat(r,"&ecosystemId=").concat(n.id)),r}},9142:(e,t,i)=>{i.d(t,{x:()=>r,N:()=>s});var a=i(18342),n=i(86085);const o=e=>{let{isWindowOpenedByFn:t,win:i,closeOpenedWindow:a}=e;t?null===i||void 0===i||i.close():i&&a?a(i):i&&i.close()},s=e=>{const t=(0,n.f)({...e,mode:"redirect"});!0===e.redirectExternally?window.open(t):window.location.href=t},r=async e=>{let t=e.openedWindow,i=!1;if(t||(t=window.open((0,n.f)({...e,mode:"popup"}),"Login to ".concat(e.authOption),"width=350, height=500"),i=!0),!t)throw new Error("Something went wrong opening pop-up");return await new Promise(((n,s)=>{const r=window.setInterval((async()=>{t.closed&&(clearInterval(r),window.removeEventListener("message",c),s(new Error("User closed login window")))}),1e3),c=async l=>{if(l.origin===(0,a.Wg)("inAppWallet"))if("object"===typeof l.data)switch(l.data.eventType){case"oauthSuccessResult":window.removeEventListener("message",c),clearInterval(r),o({isWindowOpenedByFn:i,win:t,closeOpenedWindow:e.closeOpenedWindow}),l.data.authResult&&n(l.data.authResult);break;case"oauthFailureResult":window.removeEventListener("message",c),clearInterval(r),o({isWindowOpenedByFn:i,win:t,closeOpenedWindow:e.closeOpenedWindow}),s(new Error(l.data.errorString))}else s(new Error("Invalid event data"))};window.addEventListener("message",c)}))}},12679:(e,t,i)=>{i.r(t),i.d(t,{InAppWebConnector:()=>T});var a=i(18342),n=i(22318),o=i(49703),s=i(89953);function r(){return"".concat((0,a.Wg)("inAppWallet"),"/api/2024-05-05/login/passkey/callback")}function c(e,t){return"".concat((0,a.Wg)("inAppWallet"),"/api/2024-05-05/login/passkey?type=").concat(e).concat(t?"&username=".concat(t):"")}async function l(e){var t,i,a,n;if(!e.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const l=new s.t({storage:e.storage,clientId:e.client.clientId,ecosystemId:null===(t=e.ecosystem)||void 0===t?void 0:t.id}),d=(0,o.KI)(e.client,e.ecosystem),u=null!==(i=e.username)&&void 0!==i?i:function(e){var t;return"".concat(null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:"wallet","-").concat((new Date).toISOString())}(e.ecosystem),h=await d(c("sign-up",u)),p=await h.json();if(!p.challenge)throw new Error("No challenge received");const m=p.challenge,y=await e.passkeyClient.register({name:u,challenge:m,rp:e.rp}),w={};null!==(a=e.ecosystem)&&void 0!==a&&a.partnerId&&(w["x-ecosystem-partner-id"]=e.ecosystem.partnerId),null!==(n=e.ecosystem)&&void 0!==n&&n.id&&(w["x-ecosystem-id"]=e.ecosystem.id);const g=await d(r(),{method:"POST",headers:{"Content-Type":"application/json",...w},body:JSON.stringify({type:"sign-up",authenticatorData:y.authenticatorData,credentialId:y.credentialId,serverVerificationId:p.serverVerificationId,clientData:y.clientData,username:u,credential:{publicKey:y.credential.publicKey,algorithm:y.credential.algorithm},origin:y.origin,rpId:e.rp.id})}),v=await g.json();var I;if(!v||!v.storedToken)throw new Error("Error verifying passkey: ".concat(null!==(I=v.message)&&void 0!==I?I:"unknown error"));return await l.savePasskeyCredentialId(y.credentialId),v}var d=i(93431),u=i(86085);var h=i(35770),p=i(387);function m(e){return new Promise((t=>{setTimeout(t,1e3*e)}))}const y={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},w=new Map;class g{constructor(e){let{link:t,baseUrl:i,iframeId:a,container:n=document.body,onIframeInitialize:o}=e;Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.iframeBaseUrl=i;let s=document.getElementById(a);const r=new URL(t);if(!s||s.src!==r.href){s=document.createElement("iframe");const e={...y};Object.assign(s.style,e),s.setAttribute("id",a),s.setAttribute("fetchpriority","high"),n.appendChild(s),s.src=r.href;const t=e=>{if("ewsIframeLoaded"===e.data.eventType){if(window.removeEventListener("message",t),!s)return void console.warn("thirdweb iFrame not found");this.onIframeLoadHandler(s,o)()}};window.addEventListener("message",t)}this.iframe=s}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{var i;const a=new MessageChannel,n=new Promise(((i,n)=>{a.port1.onmessage=o=>{const{data:s}=o;a.port1.close(),s.success||n(new Error(s.error)),w.set(e.src,!0),t&&t(),i(!0)}}));null===e||void 0===e||null===(i=e.contentWindow)||void 0===i||i.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await n}}async call(e){var t;let{procedureName:i,params:a,showIframe:n=!1}=e;for(;!w.get(this.iframe.src);)await m(this.POLLING_INTERVAL_SECONDS);n&&(this.iframe.style.display="block",await m(.005));const o=new MessageChannel,s=new Promise(((e,t)=>{o.port1.onmessage=async i=>{const{data:a}=i;o.port1.close(),n&&(await m(.1),this.iframe.style.display="none"),a.success?e(a.data):t(new Error(a.error))}}));return null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage({eventType:i,data:a},this.iframeBaseUrl,[o.port2]),s}destroy(){w.delete(this.iframe.src)}}class v extends g{constructor(e){let{clientId:t,baseUrl:i,ecosystem:a}=e;super({iframeId:f+((null===a||void 0===a?void 0:a.id)||""),link:I({clientId:t,path:p.CW,ecosystem:a,baseUrl:i}).href,baseUrl:i,container:document.body}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.clientId=t,this.ecosystem=a}async onIframeLoadedInitVariables(){var e,t,i;const a=new s.t({storage:n.n,clientId:this.clientId,ecosystemId:null===(e=this.ecosystem)||void 0===e?void 0:e.id});return{authCookie:await a.getAuthCookie(),deviceShareStored:await a.getDeviceShare(),walletUserId:await a.getWalletUserId(),clientId:this.clientId,partnerId:null===(t=this.ecosystem)||void 0===t?void 0:t.partnerId,ecosystemId:null===(i=this.ecosystem)||void 0===i?void 0:i.id}}}function I(e){let{clientId:t,baseUrl:i,path:a,ecosystem:n,queryParams:o}=e;const s=new URL("".concat(a),i);if(o)for(const c of Object.keys(o)){var r;s.searchParams.set(c,(null===(r=o[c])||void 0===r?void 0:r.toString())||"")}return s.searchParams.set("clientId",t),void 0!==(null===n||void 0===n?void 0:n.partnerId)&&s.searchParams.set("partnerId",n.partnerId),void 0!==(null===n||void 0===n?void 0:n.id)&&s.searchParams.set("ecosystemId",n.id),s}const f="thirdweb-in-app-wallet-iframe";class b{constructor(e){let{baseUrl:t,querier:i,preLogin:a,postLogin:n,client:o,ecosystem:s}=e;Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=t,this.LoginQuerier=i,this.preLogin=a,this.postLogin=n,this.client=o,this.ecosystem=s}async sendEmailLoginOtp(e){let{email:t}=e;return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:t}})}}class L extends b{async authenticateWithModal(){return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0})}async loginWithModal(){await this.preLogin();const e=await this.authenticateWithModal();return this.postLogin(e)}async authenticateWithIframe(e){let{email:t}=e;return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0})}async loginWithIframe(e){let{email:t}=e;await this.preLogin();const i=await this.authenticateWithIframe({email:t});return this.postLogin(i)}async authenticateWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:i}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");await this.preLogin();const a=await this.authenticateWithCustomJwt({encryptionKey:t,jwt:i});return this.postLogin(a)}async authenticateWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;return this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:t,payload:i}})}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom auth");await this.preLogin();const a=await this.authenticateWithCustomAuthEndpoint({encryptionKey:t,payload:i});return this.postLogin(a)}async authenticateWithEmailOtp(e){let{email:t,otp:i,recoveryCode:a}=e;return this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:i,recoveryCode:a}})}async loginWithEmailOtp(e){let{email:t,otp:i,recoveryCode:a}=e;const n=await this.authenticateWithEmailOtp({email:t,otp:i,recoveryCode:a});return this.postLogin(n)}async authenticateWithSmsOtp(e){let{phoneNumber:t,otp:i,recoveryCode:a}=e;return this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:t,otp:i,recoveryCode:a}})}async loginWithSmsOtp(e){let{phoneNumber:t,otp:i,recoveryCode:a}=e;const n=await this.authenticateWithSmsOtp({phoneNumber:t,otp:i,recoveryCode:a});return this.postLogin(n)}}class W{constructor(e){let{client:t,querier:i,onAuthSuccess:a,ecosystem:o,baseUrl:r}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.AuthQuerier=i,this.localStorage=new s.t({storage:n.n,clientId:t.clientId,ecosystemId:null===o||void 0===o?void 0:o.id}),this.onAuthSuccess=a,this.BaseLogin=new L({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},ecosystem:o,querier:i,client:t,baseUrl:r})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:i}=e;t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString);return await this.onAuthSuccess({storedToken:t,walletDetails:i})}async loginWithAuthToken(e,t){await this.preLogin();const i=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(i)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(e){return this.BaseLogin.loginWithIframe(e)}async authenticateWithIframe(e){return this.BaseLogin.authenticateWithIframe(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async authenticateWithCustomJwt(e){return this.BaseLogin.authenticateWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async authenticateWithCustomAuthEndpoint(e){return this.BaseLogin.authenticateWithCustomAuthEndpoint(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async loginWithEmailOtp(e){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(e)}async authenticateWithEmailOtp(e){return this.BaseLogin.authenticateWithEmailOtp(e)}async loginWithSmsOtp(e){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(e)}async authenticateWithSmsOtp(e){return this.BaseLogin.authenticateWithSmsOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),i=await this.localStorage.removeWalletUserId();return{success:e||t||i}}}var O=i(9142);const E=async e=>{const{client:t,ecosystem:i}=e,a=(0,u.K)({authOption:e.strategy,client:e.client,ecosystem:e.ecosystem}),n={"Content-Type":"application/json","x-client-id":t.clientId};null!==i&&void 0!==i&&i.id&&(n["x-ecosystem-id"]=i.id),null!==i&&void 0!==i&&i.partnerId&&(n["x-ecosystem-partner-id"]=i.partnerId);const o=(()=>{switch(e.strategy){case"email":return{email:e.email,code:e.verificationCode};case"phone":return{phone:e.phoneNumber,code:e.verificationCode}}})(),s=await fetch(a,{method:"POST",headers:n,body:JSON.stringify(o)});if(!s.ok)throw new Error("Failed to verify verification code");return await s.json()};var k=i(9893);var C=i(72364),P=i(83423),S=i(3340),A=i(93300);class N{constructor(e){let{client:t,ecosystem:i,querier:a}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=i,this.walletManagerQuerier=a,this.localStorage=new s.t({storage:n.n,clientId:t.clientId,ecosystemId:null===i||void 0===i?void 0:i.id})}async postWalletSetUp(e){let{deviceShareStored:t,walletAddress:i,isIframeStorageEnabled:a,walletUserId:n}=e;return a||await this.localStorage.saveDeviceShare(t,n),{walletAddress:i}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===h.P1.LOGGED_IN_WALLET_INITIALIZED?{status:h.P1.LOGGED_IN_WALLET_INITIALIZED,...e.user,account:await this.getAccount()}:e.status===h.P1.LOGGED_IN_NEW_DEVICE||e.status===h.P1.LOGGED_IN_WALLET_UNINITIALIZED?{status:h.P1.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async getAccount(){var e,t,i;const n=this.walletManagerQuerier,o=this.client,s=null===(e=this.ecosystem)||void 0===e?void 0:e.partnerId,r=!!this.ecosystem,c=null!==(t=this.ecosystem)&&void 0!==t&&t.partnerId?await(async(e,t)=>{const i=await fetch("".concat((0,a.Wg)("inAppWallet"),"/api/2024-05-05/ecosystem-wallet/").concat(e,"/partner/").concat(t),{headers:{"x-ecosystem-id":e,"x-ecosystem-partner-id":t||""}});return await i.json()})(this.ecosystem.id,null===(i=this.ecosystem)||void 0===i?void 0:i.partnerId):void 0,{address:l}=await n.call({procedureName:"getAddress",params:void 0}),d=async e=>{var t;const i={to:null!==(t=e.to)&&void 0!==t?t:void 0,data:e.data,value:e.value,gasLimit:e.gas,nonce:e.nonce,chainId:e.chainId};e.maxFeePerGas?(i.accessList=e.accessList,i.maxFeePerGas=e.maxFeePerGas,i.maxPriorityFeePerGas=e.maxPriorityFeePerGas,i.type=2):(i.gasPrice=e.gasPrice,i.type=0);const o=(0,a.JD)().rpc,{signedTransaction:l}=await n.call({procedureName:"signTransaction",params:{transaction:i,chainId:e.chainId,partnerId:s,rpcEndpoint:"https://".concat(e.chainId,".").concat(o)},showIframe:(null===c||void 0===c||!c.permissions.includes("FULL_CONTROL_V1"))&&r});return l};return{address:(0,P.bv)(l),async signTransaction(e){if(!e.chainId)throw new Error("chainId required in tx to sign");return d({...e,chainId:e.chainId})},async sendTransaction(e){const t=(0,C.getRpcClient)({client:o,chain:(0,k.Q4)(e.chainId)}),i=await d(e);return{transactionHash:await async function(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}(t,i)}},async signMessage(e){let{message:t}=e;const i="string"===typeof t?t:t.raw instanceof Uint8Array?t.raw:(0,S.IQ)(t.raw),{signedMessage:a}=await n.call({procedureName:"signMessage",params:{message:i,partnerId:s,chainId:1},showIframe:(null===c||void 0===c||!c.permissions.includes("FULL_CONTROL_V1"))&&r});return a},async signTypedData(e){var t;const i=(0,A.y)(e);null!==(t=i.types)&&void 0!==t&&t.EIP712Domain&&(i.types.EIP712Domain=void 0);const o=i.domain,l=null===o||void 0===o?void 0:o.chainId,d={verifyingContract:null===o||void 0===o?void 0:o.verifyingContract,name:null===o||void 0===o?void 0:o.name,version:null===o||void 0===o?void 0:o.version};l&&(d.chainId=l);const u=(0,a.JD)().rpc,{signedTypedData:h}=await n.call({procedureName:"signTypedDataV4",params:{domain:d,types:i.types,message:i.message,chainId:l||1,partnerId:s,rpcEndpoint:"https://".concat(l,".").concat(u)},showIframe:(null===c||void 0===c||!c.permissions.includes("FULL_CONTROL_V1"))&&r});return h}}}}class T{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor(e){let{client:t,onAuthSuccess:i,ecosystem:n,passkeyDomain:o}=e;if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(t.clientId))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const s=(0,a.Wg)("inAppWallet");this.client=t,this.passkeyDomain=o,this.querier=new v({clientId:t.clientId,ecosystem:n,baseUrl:s}),this.wallet=new N({client:t,ecosystem:n,querier:this.querier}),this.auth=new W({client:t,querier:this.querier,baseUrl:s,ecosystem:n,onAuthSuccess:async e=>(null===i||void 0===i||i(e),await this.wallet.postWalletSetUp({...e.walletDetails,walletUserId:e.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{partnerId:null===n||void 0===n?void 0:n.partnerId,ecosystemId:null===n||void 0===n?void 0:n.id,deviceShareStored:e.walletDetails.deviceShareStored,clientId:this.client.clientId,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:h.P1.LOGGED_IN_WALLET_INITIALIZED,authDetails:e.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:e.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}getAccount(){return this.wallet.getAccount()}async preAuthenticate(e){return(async e=>{const{client:t,ecosystem:i}=e,a=(0,u.f)({client:t,ecosystem:i,authOption:e.strategy}),n={"Content-Type":"application/json","x-client-id":t.clientId};null!==i&&void 0!==i&&i.id&&(n["x-ecosystem-id"]=i.id),null!==i&&void 0!==i&&i.partnerId&&(n["x-ecosystem-partner-id"]=i.partnerId);const o=(()=>{switch(e.strategy){case"email":return{email:e.email};case"phone":return{phone:e.phoneNumber}}})(),s=await fetch(a,{method:"POST",headers:n,body:JSON.stringify(o)});if(!s.ok)throw new Error("Failed to send verification code");return await s.json()})({...e,client:this.wallet.client,ecosystem:this.wallet.ecosystem})}authenticateWithRedirect(e){(0,O.N)({authOption:e,client:this.wallet.client,ecosystem:this.wallet.ecosystem})}async loginWithAuthToken(e){return this.auth.loginWithAuthToken(e)}async authenticate(e){const t=e.strategy;switch(t){case"email":case"phone":return E({...e,client:this.wallet.client,ecosystem:this.wallet.ecosystem});case"jwt":return this.auth.authenticateWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"passkey":return this.passkeyAuth(e);case"auth_endpoint":return this.auth.authenticateWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.authenticateWithIframe({email:e.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"farcaster":case"discord":return(0,O.x)({authOption:t,client:this.wallet.client,ecosystem:this.wallet.ecosystem,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow});case"wallet":return async function(e){const{wallet:t,chain:i}=e,a=await t.connect({client:e.client}),n=(0,o.KI)(e.client,e.ecosystem),s=await(async()=>{const t=(0,u.f)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),o=await n("".concat(t,"&address=").concat(a.address,"&chainId=").concat(i.id));if(!o.ok)throw new Error("Failed to generate SIWE login payload");return await o.json()})(),{signature:r}=await(0,d.signLoginPayload)({payload:s,account:a});return await(async()=>{const t=(0,u.K)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),i=await n("".concat(t,"&signature=").concat(r,"&payload=").concat(encodeURIComponent(s)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signature:r,payload:s})});if(!i.ok)throw new Error("Failed to verify SIWE signature");return await i.json()})()}({ecosystem:this.wallet.ecosystem,client:this.wallet.client,wallet:e.wallet,chain:e.chain})}}async connect(e){const t=e.strategy;switch(t){case"jwt":return this.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return this.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.loginWithIframe({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{const t=await this.passkeyAuth(e);return this.loginWithAuthToken(t)}case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"discord":{const t=await this.authenticate(e);return this.auth.loginWithAuthToken(t)}default:!function(e,t){throw new Error(null!==t&&void 0!==t?t:"Invalid param: ".concat(e))}(t)}}async logout(){return await this.auth.logout()}async passkeyAuth(e){var t,a,d,u;const{PasskeyWebClient:h}=await i.e(63109).then(i.bind(i,63109)),p=new h,m=n.n;var y,w;return"sign-up"===e.type?l({client:this.wallet.client,ecosystem:this.wallet.ecosystem,username:e.passkeyName,passkeyClient:p,storage:m,rp:{id:null!==(y=this.passkeyDomain)&&void 0!==y?y:window.location.hostname,name:null!==(w=this.passkeyDomain)&&void 0!==w?w:window.document.title}}):async function(e){var t,i,a,n;if(!e.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const l=new s.t({storage:e.storage,clientId:e.client.clientId,ecosystemId:null===(t=e.ecosystem)||void 0===t?void 0:t.id}),d=(0,o.KI)(e.client,e.ecosystem),u=await d(c("sign-in")),h=await u.json();if(!h.challenge)throw new Error("No challenge received");const p=h.challenge,m=null!==(i=await l.getPasskeyCredentialId())&&void 0!==i?i:void 0,y=await e.passkeyClient.authenticate({credentialId:m,challenge:p,rp:e.rp}),w={};null!==(a=e.ecosystem)&&void 0!==a&&a.partnerId&&(w["x-ecosystem-partner-id"]=e.ecosystem.partnerId),null!==(n=e.ecosystem)&&void 0!==n&&n.id&&(w["x-ecosystem-id"]=e.ecosystem.id);const g=await d(r(),{method:"POST",headers:{"Content-Type":"application/json",...w},body:JSON.stringify({type:"sign-in",authenticatorData:y.authenticatorData,credentialId:y.credentialId,serverVerificationId:h.serverVerificationId,clientData:y.clientData,signature:y.signature,origin:y.origin,rpId:e.rp.id})}),v=await g.json();var I;if(!v||!v.storedToken)throw new Error("Error verifying passkey: ".concat(null!==(I=v.message)&&void 0!==I?I:"unknown error"));return await l.savePasskeyCredentialId(y.credentialId),v}({client:this.wallet.client,ecosystem:this.wallet.ecosystem,passkeyClient:p,storage:m,rp:{id:null!==(t=null===(a=e.domain)||void 0===a?void 0:a.hostname)&&void 0!==t?t:window.location.hostname,name:null!==(d=null===(u=e.domain)||void 0===u?void 0:u.displayName)&&void 0!==d?d:window.document.title}})}}}}]);
//# sourceMappingURL=12679.65b31d35.chunk.js.map